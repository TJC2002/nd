<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.nd.mapper.UploadTaskMapper">
    
    <resultMap id="UploadTaskResultMap" type="com.example.nd.model.UploadTask">
        <id property="id" column="id"/>
        <result property="uploadId" column="upload_id"/>
        <result property="userId" column="user_id"/>
        <result property="fileName" column="file_name"/>
        <result property="fileSize" column="file_size"/>
        <result property="fileType" column="file_type"/>
        <result property="fileHash" column="file_hash"/>
        <result property="chunkSize" column="chunk_size"/>
        <result property="totalChunks" column="total_chunks"/>
        <result property="uploadedChunks" column="uploaded_chunks"/>
        <result property="status" column="status"/>
        <result property="tempPath" column="temp_path"/>
        <result property="parentFolderId" column="parent_folder_id"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
    </resultMap>
    
    <select id="getUploadTaskById" resultMap="UploadTaskResultMap">
        SELECT * FROM upload_tasks WHERE id = #{id}
    </select>
    
    <select id="getUploadTaskByUploadId" resultMap="UploadTaskResultMap">
        SELECT * FROM upload_tasks WHERE upload_id = #{uploadId}
    </select>
    
    <insert id="insertUploadTask" parameterType="com.example.nd.model.UploadTask" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO upload_tasks (upload_id, user_id, file_name, file_size, file_type, file_hash, chunk_size, total_chunks, uploaded_chunks, status, temp_path, parent_folder_id, created_at, updated_at)
        VALUES (#{uploadId}, #{userId}, #{fileName}, #{fileSize}, #{fileType}, #{fileHash}, #{chunkSize}, #{totalChunks}, #{uploadedChunks}, #{status}, #{tempPath}, #{parentFolderId}, NOW(), NOW())
    </insert>
    
    <update id="updateUploadTask" parameterType="com.example.nd.model.UploadTask">
        UPDATE upload_tasks
        SET uploaded_chunks = #{uploadedChunks}, status = #{status}, updated_at = NOW()
        WHERE id = #{id}
    </update>
    
    <delete id="deleteUploadTask">
        DELETE FROM upload_tasks WHERE id = #{id}
    </delete>
    
    <delete id="deleteUploadTaskByUploadId">
        DELETE FROM upload_tasks WHERE upload_id = #{uploadId}
    </delete>
    
    <update id="updateUploadedChunks">
        UPDATE upload_tasks
        SET uploaded_chunks = #{uploadedChunks}, updated_at = NOW()
        WHERE upload_id = #{uploadId}
    </update>
</mapper>
