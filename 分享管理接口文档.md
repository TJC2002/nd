# 分享管理接口文档

## 概述

本文档详细说明了 ND 网盘系统中与文件分享相关的所有 API 接口，包括创建分享、验证分享、访问分享、下载分享文件和管理分享记录等功能。

## 接口列表

### 1. 创建分享链接
- **方法**: `POST`
- **路径**: `/shares`
- **功能**: 为指定文件创建分享链接
- **认证**: 需要 Bearer Token
- **请求体**:
  ```json
  {
    "fileId": 123,
    "password": "optional",
    "expireTime": "2026-12-31T23:59:59",
    "maxDownloads": 10
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "shareCode": "abcdef123456",
      "fileId": 123,
      "fileName": "example.txt",
      "password": "optional",
      "expireTime": "2026-12-31T23:59:59",
      "maxDownloads": 10,
      "downloadCount": 0,
      "createdAt": "2026-01-21T12:00:00"
    }
  }
  ```

### 2. 获取分享记录
- **方法**: `GET`
- **路径**: `/shares`
- **功能**: 获取用户的所有分享记录
- **认证**: 需要 Bearer Token
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": [
      {
        "id": 1,
        "shareCode": "abcdef123456",
        "fileId": 123,
        "fileName": "example.txt",
        "password": "optional",
        "expireTime": "2026-12-31T23:59:59",
        "maxDownloads": 10,
        "downloadCount": 0,
        "createdAt": "2026-01-21T12:00:00"
      }
    ]
  }
  ```

### 3. 验证分享链接
- **方法**: `GET`
- **路径**: `/shares/{shareCode}`
- **功能**: 验证分享链接是否有效
- **认证**: 需要 Bearer Token
- **参数**:
  - `shareCode` (路径参数): 分享码
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "shareCode": "abcdef123456",
      "fileId": 123,
      "fileName": "example.txt",
      "password": "optional",
      "expireTime": "2026-12-31T23:59:59",
      "maxDownloads": 10,
      "downloadCount": 0,
      "createdAt": "2026-01-21T12:00:00"
    }
  }
  ```

### 4. 访问分享链接
- **方法**: `POST`
- **路径**: `/shares/{shareCode}/access`
- **功能**: 验证密码并访问分享的文件
- **认证**: 需要 Bearer Token
- **参数**:
  - `shareCode` (路径参数): 分享码
- **请求体**:
  ```json
  {
    "password": "optional"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 123,
      "userId": 1,
      "parentFolderId": 0,
      "fileName": "example.txt",
      "originalName": "example.txt",
      "isFolder": false,
      "createdAt": "2026-01-21T12:00:00",
      "updatedAt": "2026-01-21T12:00:00"
    }
  }
  ```

### 5. 下载分享文件
- **方法**: `GET`
- **路径**: `/shares/{shareCode}/download`
- **功能**: 下载分享的文件
- **认证**: 需要 Bearer Token
- **参数**:
  - `shareCode` (路径参数): 分享码
  - `password` (查询参数, 可选): 分享密码
- **响应**: 文件二进制流

### 6. 撤销分享链接
- **方法**: `DELETE`
- **路径**: `/shares/{shareId}`
- **功能**: 撤销指定的分享链接
- **认证**: 需要 Bearer Token
- **参数**:
  - `shareId` (路径参数): 分享ID
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": "Share revoked successfully"
  }
  ```

### 7. 获取分享统计
- **方法**: `GET`
- **路径**: `/shares/stats`
- **功能**: 获取用户的分享统计信息
- **认证**: 需要 Bearer Token
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "totalShares": 5,
      "activeShares": 3,
      "totalDownloads": 12,
      "todayDownloads": 2
    }
  }
  ```

### 8. 验证分享链接（POST 方法）
- **方法**: `POST`
- **路径**: `/shares/verify`
- **功能**: 验证分享链接的有效性
- **认证**: 不需要
- **请求体**:
  ```json
  {
    "shareCode": "abcdef123456",
    "password": "optional"
  }
  ```
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": {
      "id": 1,
      "shareCode": "abcdef123456",
      "fileId": 123,
      "fileName": "example.txt",
      "password": "optional",
      "expireTime": "2026-12-31T23:59:59",
      "maxDownloads": 10,
      "downloadCount": 0,
      "createdAt": "2026-01-21T12:00:00"
    }
  }
  ```

### 9. 撤销分享链接（POST 方法）
- **方法**: `POST`
- **路径**: `/shares/{shareId}/revoke`
- **功能**: 撤销指定的分享链接
- **认证**: 需要 Bearer Token
- **参数**:
  - `shareId` (路径参数): 分享ID
- **响应**:
  ```json
  {
    "code": 200,
    "message": "success",
    "data": null
  }
  ```

## 认证说明

- 除了 `/shares/verify` 接口外，所有其他接口都需要 Bearer Token 认证
- 认证方式: 在请求头中添加 `Authorization: Bearer <token>`

## 数据模型

### CreateShareRequest
- `fileId` (必填): 文件ID
- `password` (可选): 分享密码
- `expireTime` (可选): 过期时间
- `maxDownloads` (可选): 最大下载次数

### VerifyShareRequest
- `shareCode` (必填): 分享码
- `password` (可选): 分享密码

### AccessShareRequest
- `password` (可选): 分享密码

### ShareResponse
- `id`: 分享ID
- `shareCode`: 分享码
- `fileId`: 文件ID
- `fileName`: 文件名
- `password`: 分享密码
- `expireTime`: 过期时间
- `maxDownloads`: 最大下载次数
- `downloadCount`: 已下载次数
- `createdAt`: 创建时间

### ShareStatsResponse
- `totalShares`: 总分享数
- `activeShares`: 活跃分享数
- `totalDownloads`: 总下载次数
- `todayDownloads`: 今日下载次数

## 错误处理

所有接口在遇到错误时都会返回统一的错误响应格式：

```json
{
  "code": 400,
  "message": "错误信息",
  "data": null
}
```

常见错误代码：
- `400`: 请求参数错误
- `401`: 未授权
- `403`: 权限不足
- `404`: 资源不存在
- `500`: 服务器内部错误

## 使用示例

### 示例 1: 创建分享链接
```bash
curl -X POST http://localhost:8080/shares \
  -H "Authorization: Bearer <token>" \
  -H "Content-Type: application/json" \
  -d '{
    "fileId": 123,
    "password": "123456",
    "expireTime": "2026-12-31T23:59:59",
    "maxDownloads": 5
  }'
```

### 示例 2: 验证分享链接
```bash
curl -X POST http://localhost:8080/shares/verify \
  -H "Content-Type: application/json" \
  -d '{
    "shareCode": "abcdef123456",
    "password": "123456"
  }'
```

### 示例 3: 下载分享文件
```bash
curl -X GET "http://localhost:8080/shares/abcdef123456/download?password=123456" \
  -H "Authorization: Bearer <token>" \
  -o downloaded_file.txt
```

### 示例 4: 获取分享记录
```bash
curl -X GET http://localhost:8080/shares \
  -H "Authorization: Bearer <token>"
```

### 示例 5: 撤销分享链接
```bash
curl -X DELETE http://localhost:8080/shares/1 \
  -H "Authorization: Bearer <token>"
```

## 注意事项

1. **安全性**: 分享密码应使用强密码，避免使用简单密码
2. **过期时间**: 建议为分享链接设置合理的过期时间，以减少安全风险
3. **下载限制**: 对于重要文件，建议设置最大下载次数限制
4. **访问日志**: 系统会记录所有分享访问日志，包括 IP 地址和用户代理信息
5. **文件大小**: 分享文件大小受系统配置限制，超过限制的文件可能无法正常分享

## 技术支持

如有问题，请查看：
- API 文档：`http://your-server:8080/swagger-ui.html`
- 服务器日志：`logs/nd.log`
- 联系管理员获取更多帮助
