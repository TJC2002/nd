# ND网盘 - 表结构功能覆盖分析与补充

## 1. 现有表结构覆盖情况分析

### 1.1 已覆盖的功能模块

#### 1.1.1 账户与设备管理
- ✅ 用户登录、密码找回、账号注销（users表）
- ✅ 设备管控（查看设备列表、远程下线）（devices、device_logs表）

#### 1.1.2 核心存储与备份
- ✅ 自定义存储空间（users、user_storage表）
- ✅ 多端自动同步备份（sync_tasks、sync_logs表）
- ✅ 离线下载（download_tasks表）
- ✅ 历史版本恢复（file_versions表）

#### 1.1.3 文件管理与在线处理
- ✅ 基础操作（新建、上传/下载/移动/删除/重命名、批量操作）（files表）
- ✅ 智能检索（基于元数据，需结合搜索引擎）（files表）
- ✅ 在线预览（files表）
- ✅ 格式转换与解压（需补充任务表）

#### 1.1.4 分享
- ✅ 链接分享（share_links表）
- ✅ 权限控制（share_links表）

#### 1.1.5 音视频与内容消费
- ✅ 全格式兼容播放（files表）
- ✅ 增强播放控制（playback_records表）
- ✅ 播放记忆与收藏（playback_records、favorites表）
- ✅ 字幕与音轨管理（subtitles表）
- ✅ 影音内容管理（albums、album_files表）
- ✅ 投屏与多端无缝播放（cast_devices表）
- ✅ 离线缓存（cache_files表）
- ✅ AI辅助工具（ai_tasks表）

#### 1.1.6 后端管理
- ✅ 存储介质管理（storage_nodes表）
- ✅ 文件元数据与秒传管理（files表）
- ✅ 用户存储空间管理（user_storage表）
- ✅ 系统全局配置（system_configs表）

### 1.2 未完全覆盖的功能点

#### 1.2.1 格式转换与解压
- ❌ 转换/解压任务管理（缺少任务表）

#### 1.2.2 分享
- ❌ 分享链接访问记录（缺少访问日志表）

#### 1.2.3 系统管理
- ❌ 用户个性化设置（缺少用户设置表）
- ❌ 系统通知（缺少通知表）

## 2. 需要补充的表名

### 2.1 任务管理相关
- **conversion_tasks**：格式转换/解压任务表，管理格式转换和在线解压任务

### 2.2 分享相关
- **share_access_logs**：分享链接访问日志表，记录分享链接的访问情况

### 2.3 系统管理相关
- **user_settings**：用户设置表，存储用户的个性化设置（主题、语言等）
- **notifications**：通知表，存储系统通知和操作结果通知

## 3. 补充表结构设计

### 3.3 conversion_tasks 表
- **id**：主键
- **user_id**：外键关联users表
- **file_id**：外键关联files表
- **task_type**：任务类型（convert/extract/unzip）
- **source_format**：源格式
- **target_format**：目标格式
- **status**：任务状态（pending/running/success/failed）
- **result_path**：结果存储路径
- **created_at**：创建时间
- **completed_at**：完成时间

### 3.4 share_access_logs 表
- **id**：主键
- **share_link_id**：外键关联share_links表
- **access_ip**：访问IP
- **access_time**：访问时间
- **device_info**：访问设备信息
- **status**：访问状态（success/failed）

### 3.5 user_settings 表
- **id**：主键
- **user_id**：外键关联users表（唯一）
- **theme**：界面主题（light/dark）
- **language**：语言偏好
- **notifications_enabled**：通知开关
- **sync_settings**：同步设置（JSON格式）
- **updated_at**：更新时间

### 3.6 notifications 表
- **id**：主键
- **user_id**：外键关联users表
- **type**：通知类型（system/operation/alert）
- **title**：通知标题
- **content**：通知内容
- **is_read**：是否已读
- **created_at**：创建时间

## 4. 最终表名列表

### 4.1 核心表名（原有）
- users
- devices
- device_logs
- files
- storage_nodes
- sync_tasks
- sync_logs
- download_tasks
- file_versions
- recycle_bin
- share_links
- playback_records
- favorites
- subtitles
- albums
- album_files
- cast_devices
- cache_files
- ai_tasks
- system_configs
- operation_logs
- user_storage

### 4.2 补充表名（新增）
- conversion_tasks
- share_access_logs
- user_settings
- notifications

## 5. 总结

通过补充上述表名，ND网盘的数据库表结构将能够完全支持所有功能点，包括：
- ✅ 格式转换与解压任务管理
- ✅ 分享链接访问记录
- ✅ 用户个性化设置
- ✅ 系统通知

最终的表结构设计覆盖了所有核心功能模块，为系统的稳定运行和功能扩展提供了坚实的数据基础。