# ND网盘 - 后端框架搭建与认证模块开发计划

## 阶段一：后端框架搭建

### 1.1 创建项目结构
- 创建backend目录及完整的项目结构
- 配置Maven pom.xml，添加必要依赖：
  - Spring Boot 3.0+
  - MyBatis 3.5+
  - SpringDoc OpenAPI (Swagger)
  - Spring Security + JWT
  - Redis
  - MySQL驱动
  - Lombok

### 1.2 配置文件
- 创建application.yml配置文件
- 配置数据库连接（数据库：nd）
- 配置Redis连接
- 配置JWT密钥和过期时间
- 配置MyBatis

### 1.3 基础类创建
- 创建主应用类 NdApplication.java
- 创建Swagger配置类 SwaggerConfig.java
- 创建Spring Security配置类 SecurityConfig.java
- 创建JWT工具类 JwtUtil.java

## 阶段二：数据模型与数据访问层

### 2.1 创建数据模型
- User.java - 用户实体
- Device.java - 设备实体
- DeviceLog.java - 设备日志实体

### 2.2 创建DTO类
- LoginRequest.java - 登录请求
- LoginResponse.java - 登录响应
- RefreshTokenRequest.java - 刷新令牌请求
- RefreshTokenResponse.java - 刷新令牌响应
- PasswordResetRequest.java - 密码重置请求
- UserUpdateRequest.java - 用户信息更新请求

### 2.3 创建Mapper接口
- UserMapper.java
- DeviceMapper.java
- DeviceLogMapper.java

### 2.4 创建MyBatis XML配置
- 创建 src/main/resources/mapper/AllMapper.xml
- 包含所有SQL语句

## 阶段三：服务层实现

### 3.1 认证服务
- AuthService.java - 认证服务接口
- AuthServiceImpl.java - 认证服务实现
  - 用户登录
  - 免注册登录
  - 令牌刷新
  - 用户登出
  - 密码找回
  - 密码重置
  - 账号注销

### 3.2 用户服务
- UserService.java - 用户服务接口
- UserServiceImpl.java - 用户服务实现
  - 获取用户信息
  - 更新用户信息
  - 修改密码

### 3.3 设备服务
- DeviceService.java - 设备服务接口
- DeviceServiceImpl.java - 设备服务实现
  - 获取设备列表
  - 远程下线设备
  - 记录设备登录

## 阶段四：控制器层实现

### 4.1 认证控制器
- AuthController.java
  - POST /api/auth/login - 用户登录
  - POST /api/auth/guest-login - 免注册登录
  - POST /api/auth/refresh - 令牌刷新
  - POST /api/auth/logout - 用户登出
  - POST /api/auth/forgot-password - 密码找回
  - POST /api/auth/reset-password - 密码重置
  - POST /api/auth/delete-account - 账号注销

### 4.2 用户控制器
- UserController.java
  - GET /api/users/me - 获取当前用户信息
  - PUT /api/users/me - 更新当前用户信息
  - PUT /api/users/me/password - 修改密码

### 4.3 设备控制器
- DeviceController.java
  - GET /api/devices - 获取设备列表
  - POST /api/devices/{deviceId}/logout - 远程下线设备

## 阶段五：测试与验证

### 5.1 启动应用
- 启动Spring Boot应用
- 验证Swagger UI可访问

### 5.2 接口测试
- 使用Swagger UI测试所有接口
- 验证JWT认证流程
- 验证设备管理功能

### 5.3 数据库验证
- 验证数据正确写入数据库
- 验证Redis缓存正常工作

## 接口文档

### 认证接口
| 接口 | 方法 | 路径 | 功能描述 |
|------|------|------|----------|
| 用户登录 | POST | /api/auth/login | 用户名密码登录 |
| 免注册登录 | POST | /api/auth/guest-login | 设备信息免注册登录 |
| 令牌刷新 | POST | /api/auth/refresh | 刷新访问令牌 |
| 用户登出 | POST | /api/auth/logout | 用户登出 |
| 密码找回 | POST | /api/auth/forgot-password | 发送密码找回链接 |
| 密码重置 | POST | /api/auth/reset-password | 重置密码 |
| 账号注销 | POST | /api/auth/delete-account | 注销用户账号 |

### 用户管理接口
| 接口 | 方法 | 路径 | 功能描述 |
|------|------|------|----------|
| 获取用户信息 | GET | /api/users/me | 获取当前登录用户信息 |
| 更新用户信息 | PUT | /api/users/me | 更新当前用户信息 |
| 修改密码 | PUT | /api/users/me/password | 修改当前用户密码 |

### 设备管理接口
| 接口 | 方法 | 路径 | 功能描述 |
|------|------|------|----------|
| 获取设备列表 | GET | /api/devices | 获取用户的所有登录设备 |
| 远程下线设备 | POST | /api/devices/{deviceId}/logout | 强制下线指定设备 |

## 预期成果
1. 完整的Spring Boot后端框架
2. 12个RESTful API接口
3. Swagger API文档可访问
4. JWT认证机制完整实现
5. 与数据库"nd"和Redis的完整集成